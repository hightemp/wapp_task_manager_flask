{% import "macros.html" as macros %}
{% include "b_header.html" %}

<form action="">

{{macros.form_hidden_fields(oR.oArgs)}}

<div class="wrapper">
    {{ macros.menu() }}
    {{ macros.list_panel(oR.oProjects, oR.aProjectsButtons, oR.sSelectProject, "project", oR.sProjectFilter) }}
    {% if oR.sCreateGroup or oR.sEditGroup %}
        <div class="edit-panel">
            <h4>Группа</h4>
            {{ macros.form_text_fields(oR.dGroupFieldsV, "group") }}
        </div>
    {% elif oR.sCreateTask or oR.sEditTask %}
        <div class="edit-panel">
            <h4>Здача</h4>
            {{ macros.form_text_fields(oR.dTaskFieldsV, "task") }}
        </div>
    {% elif oR.sCreateProject or oR.sEditProject %}
        <div class="edit-panel">
            <h4>Проект</h4>
            {{ macros.form_text_fields(oR.dProjectFieldsV, "project") }}
        </div>
    {% elif oR.sSelectProject %}
    <div class="groups-panel groups-view-list">

        {% for oGroup in oR.oGroups %}
        <div class="group" id="group-{{oGroup.id}}">
            <div class="group-name" style="background:{{oGroup.color}}">
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    </button>
                    <ul class="dropdown-menu">
                        <li><button type="submit" name="edit-group" value="{{oGroup.id}}" class="dropdown-item" href="#">Редактировать</button></li>
                        <li><button type="submit" name="remove-group" value="{{oGroup.id}}" class="dropdown-item" href="#">Удалить</button></li>
                    </ul>
                </div>
                <span>{{oGroup.name}}</span>
            </div>
            <div class="group-task-wrapper">
                {% for oTask in oR.lTasks[loop.index0] %}
                <div class="task" id="task-{{oTask.id}}">
                    <div class="task-name">
                        <div class="dropdown">
                            <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            </button>
                            <ul class="dropdown-menu">
                                <li><button type="submit" name="select-task" value="{{oTask.id}}" class="dropdown-item" href="#">Выбрать</button></li>
                                <li><button type="submit" name="edit-task" value="{{oTask.id}}" class="dropdown-item" href="#">Редактировать</button></li>
                                <li><button type="submit" name="remove-task" value="{{oTask.id}}" class="dropdown-item" href="#">Удалить</button></li>
                                {% for oMoveGroup in oR.oGroups %}
                                <li><button type="submit" name="move-task" value="{{oMoveGroup.id}}" class="dropdown-item" href="#">Перенести в {{oMoveGroup.name}}</button></li>
                                {% endfor %}
                            </ul>
                        </div>
                        <span>{{oTask.name}}</span>
                    </div>
                    <div class="task-html">{{oTask.a_html|safe}}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}

    </div>
    {% endif %}

    {% include 'task_panel.html' %}
</div>

</form>
{% include "b_footer.html" %}